var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,n=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&i(e,t,a[t]);return e},o=(e,l)=>a(e,t(l));import{_ as c}from"./notfound-fa5cb960.js";import{_ as d}from"./notflag-60268a62.js";import{_ as u}from"./team_notfound-5b1be68a.js";import{d as p,_ as m,o as y,e as f,b as g,r as v,k as h,l as b,t as D,I as x,i as w,q as k,g as C,a as P,f as T,w as S,H as $,J as _,L as V,c as N,h as j,M as O,N as E,j as F,F as L,p as M,O as q,P as B,Q as A,R as z,D as I,S as J}from"./index-7968fd82.js";import{u as U}from"./editSpace-e047ea02.js";import{t as R,u as W}from"./teamSelector-51d6675c.js";import{u as H}from"./usePlayers-98b143ee.js";import{_ as X}from"./plugin-vue_export-helper-46f75680.js";import{c as Y}from"./util-297b1e4c.js";const Q=p({name:"ArrowRightBold"}),G={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},K=[g("path",{fill:"currentColor",d:"M338.752 104.704a64 64 0 0 0 0 90.496l316.8 316.8-316.8 316.8a64 64 0 0 0 90.496 90.496l362.048-362.048a64 64 0 0 0 0-90.496L429.248 104.704a64 64 0 0 0-90.496 0z"},null,-1)];var Z=m(Q,[["render",function(e,a,t,l,r,s){return y(),f("svg",G,K)}]]);const ee=p({name:"Marquees",components:{},props:{},setup(e,a){const{proxy:t}=C();let l=v({needToScroll:!1,text:"",_checkTimer:null}),r={check(){t.$nextTick((()=>{let e=r.isOverflow();l.needToScroll=e}))},isOverflow(){let e=t.$refs.outer,a=t.$refs.inner,l=r.getWidth(e);return r.getWidth(a)>l},getWidth(e){let{width:a}=e.getBoundingClientRect();return a},startCheck(){l._checkTimer=setInterval(r.check,1e3),r.check()},stopCheck(){clearInterval(l._checkTimer)}};return h((()=>{r.startCheck()})),b((()=>{r.stopCheck()})),n(n({},D(l)),r)}}),ae={class:"scrollText",ref:"outer"},te={class:"st-section",ref:"inner"},le={key:0,class:"st-section"};var re=X(ee,[["render",function(e,a,t,l,r,s){return y(),f("div",ae,[g("div",{class:k(["st-inner",{"st-scrolling":e.needToScroll}])},[g("span",te,[x(e.$slots,"default",{},void 0,!0)],512),e.needToScroll?(y(),f("span",le,[x(e.$slots,"default",{},void 0,!0)])):w("",!0)],2)],512)}],["__scopeId","data-v-25aae93a"]]);const se={name:"playerMenu",props:{visible:{type:Boolean,default:!1},left:{type:Number,default:0},top:{type:Number,default:0},contextData:{type:Object,default:null},isEdit:{type:Boolean,default:!0}},components:{},emits:["updateNumber","delete"],setup(e,a){const{proxy:t}=C();let l=v({timer:null,newTop:e.top,newLeft:e.left}),r={handleEditNumber(){let t={jerseynumber:e.contextData.lineupData.jerseynumber,id:e.contextData.value};a.emit("updateNumber",t)},handleEdit(){t.$router.push({name:"playerEdit",query:{playerid:e.contextData.value}})},handleDelete(){a.emit("delete",e.contextData.value)}};return h((()=>{let a=document.body.offsetHeight,t=document.body.offsetWidth,r=document.querySelector("#app-contextMenu");e.top+r.offsetHeight>a?l.newTop=a-r.offsetHeight:e.left+r.offsetWidth>t&&(l.newLeft=t-70-r.offsetWidth)})),n(n({},D(l)),r)}},ie=e=>(_("data-v-27cf4b86"),e=e(),V(),e),ne=ie((()=>g("span",null,"编辑号码",-1))),oe=ie((()=>g("span",null,"删除球员",-1)));var ce=X(se,[["render",function(e,a,t,l,r,s){const i=P("EditPen"),n=P("el-icon");P("Edit");const o=P("Delete");return t.visible?(y(),f("ul",{key:0,id:"app-contextMenu",style:$({left:e.newLeft+"px",top:e.newTop+"px"}),class:"contextmenu"},[t.isEdit?(y(),f("li",{key:0,class:"flex-between",onClick:a[0]||(a[0]=(...a)=>e.handleEditNumber&&e.handleEditNumber(...a))},[ne,T(n,null,{default:S((()=>[T(i)])),_:1})])):w("",!0),w("",!0),g("li",{class:"flex-between",onClick:a[2]||(a[2]=(...a)=>e.handleDelete&&e.handleDelete(...a))},[oe,T(n,null,{default:S((()=>[T(o)])),_:1})])],4)):w("",!0)}],["__scopeId","data-v-27cf4b86"]]);const de=p({name:"playerSelector",components:{},props:{modelValue:{type:String,default:""},filterable:{type:Boolean,default:!0},remote:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,a){const t=U();H();let l=v({selectOptions:[],valueName:"",selectLoading:!1,cloneSelectOptions:[]}),r={remoteMethod(e){if(""!==e){let t;l.selectLoading=!0,t&&clearTimeout(t),t=setTimeout((()=>{l.selectLoading=!1,!isNaN(parseFloat(e))&&isFinite(e)&&(l.selectOptions=l.cloneSelectOptions.filter((a=>a.label==e)))}),500),a.emit("update:modelValue",l.valueName)}else l.selectOptions=[]},handleChange(e){a.emit("update:modelValue",e),a.emit("change",e)}};return h((()=>{l.cloneSelectOptions=t.getAllPlayerList(),l.valueName=e.modelValue})),n(n(n({},D(l)),r),H())}}),ue={style:{"margin-right":"8px"}},pe={style:{color:"var(--el-text-color-secondary)","font-size":"13px"}};var me=X(de,[["render",function(e,a,t,l,r,s){const i=P("el-select-v2");return y(),N(i,{modelValue:e.valueName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.valueName=a),filterable:e.filterable,remote:e.remote,multiple:e.multiple,clearable:e.clearable,disabled:e.disabled,options:e.selectOptions,placeholder:e.$t("message.selectPlayerPlaceholder"),onChange:e.handleChange,"remote-method":e.remoteMethod,"value-key":"value.playerid",loading:e.selectLoading},{default:S((({item:a})=>[g("span",ue,j(a.label),1),g("span",pe,j(e.getPlayerName(a.value.firstnameid,a.value.lastnameid,a.value.commonnameid)),1)])),_:1},8,["modelValue","filterable","remote","multiple","clearable","disabled","options","placeholder","onChange","remote-method","loading"])}]]);const ye=p({name:"TransferDialog",components:{teamSelector:R,playerMenu:ce,Marquees:re,playerSelector:me},props:{visible:{type:Boolean,default:!1}},emits:["close","save"],setup(e,a){const{proxy:t}=C(),l=U(),r=W(),s=H();let i=v({dialogVisible:e.visible,selectTeamData:"",selectPlayerData:"",lineupData:[],pendingTransferData:[],activeData:[],menuVisible:!1,contextData:null,left:0,top:0,loading:!1,filterOptions:[{label:"teams",value:"1"},{label:"players",value:"2"}],filterType:""}),c={handleDelete(e){i.pendingTransferData.forEach(((a,t)=>{a.value==e&&i.pendingTransferData.splice(t,1)}))},handleClose(){i.dialogVisible=!1,a.emit("close")},handleConfirm(){a.emit("save",i.pendingTransferData)},handleLoadLineup1(){if(i.selectTeamData==t.$route.query.teamid)return i.loading=!1,t.$message.warning(t.$t("message.transferError1"));i.activeData.length=0,i.lineupData.length=0,l.data.teamplayerlinks?(l.data.teamplayerlinks.forEach((e=>{if(e.teamid==i.selectTeamData){let a=l.data.players.find((a=>a.playerid==e.playerid));if(a){let t=s.getPlayerName.value(a.firstnameid,a.lastnameid,a.commonnameid);i.lineupData.push({label:t,value:e.playerid,playerdata:a,lineupData:e})}}})),i.loading=!1):t.$message.warning(`${t.$t("message.notfound")}`)},handleLoadLineup2(){i.activeData.length=0,i.lineupData.length=0,l.data.teamplayerlinks?(l.data.teamplayerlinks.forEach((e=>{if(e.playerid==i.selectPlayerData){let a=l.data.players.find((a=>a.playerid==e.playerid));if(a){let t=s.getPlayerName.value(a.firstnameid,a.lastnameid,a.commonnameid);i.lineupData.push({label:t,value:e.playerid,playerdata:a,lineupData:e})}}})),i.loading=!1):t.$message.warning(`${t.$t("message.notfound")}`)},handleClick(e){for(let a=0;a<i.activeData.length;a++)if(i.activeData[a].value==e.value&&i.activeData[a].lineupData.teamid==e.lineupData.teamid)return void i.activeData.splice(a,1);i.activeData.push(e)},handleToRight(){for(let a=0;a<i.activeData.length;a++)if(i.activeData[a].lineupData.teamid==t.$route.query.teamid)return t.$message.warning(t.$t("message.transferError2"));let e=new Set([...i.pendingTransferData,...i.activeData]);i.pendingTransferData=Array.from(e),i.activeData=[]},handleMenu(e,a,t=null){i.menuVisible=!1,setTimeout((()=>{i[a]=!0,i.left=e.pageX,i.top=e.pageY,i.contextData=t}),100)},closeMenu(){i.menuVisible=!1},handleTeamChange(){""!==i.selectTeamData&&(i.loading=!0,setTimeout((()=>{c.handleLoadLineup1()}),200))},handlePlayerChange(){""!==i.selectPlayerData&&(i.loading=!0,setTimeout((()=>{c.handleLoadLineup2()}),200))}};return h((()=>{document.addEventListener("click",c.closeMenu)})),b((()=>{document.removeEventListener("click",c.closeMenu)})),o(n(n(n(n({},D(i)),c),r),s),{ArrowRightBold:Z,ArrowLeftBold:O})}}),fe={class:"flex-start",style:{"margin-bottom":"10px"}},ge={class:"flex-center"},ve={class:"scrollAuto scrollbar lineup-box flex-start flex-warp"},he=["onClick","title"],be={class:"flex-start full-w"},De={class:"player-ability"},xe={class:"player-position"},we={class:"flex-center"},ke={class:"flex-column-center"},Ce=["src"],Pe=["src"],Te={class:"player-avatar"},Se={class:"image-slot"},$e=["src"],_e={class:"image-slot"},Ve=["src"],Ne={class:"player-name-1"},je={class:"flex-column-center",style:{width:"100px"}},Oe={class:"scrollAuto scrollbar lineup-box flex-start flex-warp"},Ee=["onContextmenu","title"],Fe={class:"flex-start full-w"},Le={class:"player-ability"},Me={class:"player-position"},qe={class:"flex-center"},Be={class:"flex-column-center"},Ae=["src"],ze=["src"],Ie={class:"player-avatar"},Je={class:"image-slot"},Ue=["src"],Re={class:"image-slot"},We=["src"],He={class:"player-name-1"},Xe={class:"dialog-footer"};var Ye=X(ye,[["render",function(e,a,t,l,r,s){const i=P("el-option"),n=P("el-select"),o=P("teamSelector"),p=P("playerSelector"),m=P("el-avatar"),v=P("el-tooltip"),h=P("el-image"),b=P("Marquees"),D=P("el-button"),x=P("el-dialog"),C=P("playerMenu"),$=E("loading");return y(),f(L,null,[T(x,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dialogVisible=a),title:e.$t("message.transfer"),"before-close":e.handleClose,top:"5vh","custom-class":"z-dialog",center:"",width:"80%"},{footer:S((()=>[g("span",Xe,[T(D,{onClick:e.handleClose},{default:S((()=>[F(j(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),T(D,{type:"primary",onClick:e.handleConfirm},{default:S((()=>[F(j(e.$t("message.confirm")),1)])),_:1},8,["onClick"])])])),default:S((()=>[g("div",null,[g("div",fe,[T(n,{modelValue:e.filterType,"onUpdate:modelValue":a[0]||(a[0]=a=>e.filterType=a),placeholder:e.$t("message.filter"),clearable:"",onChange:a[1]||(a[1]=a=>{e.selectTeamData="",e.selectPlayerData=""}),style:{width:"200px","margin-right":"10px"}},{default:S((()=>[(y(!0),f(L,null,M(e.filterOptions,(a=>(y(),N(i,{key:a.value,label:e.$t(`message.${a.label}`),value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"]),q(T(o,{modelValue:e.selectTeamData,"onUpdate:modelValue":a[2]||(a[2]=a=>e.selectTeamData=a),onChange:e.handleTeamChange},null,8,["modelValue","onChange"]),[[B,"1"===e.filterType]]),q(T(p,{modelValue:e.selectPlayerData,"onUpdate:modelValue":a[3]||(a[3]=a=>e.selectPlayerData=a),onChange:e.handlePlayerChange},null,8,["modelValue","onChange"]),[[B,"2"===e.filterType]])]),g("div",ge,[q((y(),f("div",ve,[(y(!0),f(L,null,M(e.lineupData,(a=>(y(),f("div",{class:k(["player-card flex-column-center",{"player-card-active":e.activeData.length&&e.activeData.find((e=>e.value==a.value&&e.lineupData.teamid==a.lineupData.teamid))}]),onClick:t=>e.handleClick(a),title:a.label+"("+a.value+")",key:a.value},[g("div",be,[g("span",De,j(a.playerdata.overallrating),1),g("div",xe,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",we,[g("div",ke,[T(v,{effect:"dark",content:e.getTeamName(a.lineupData.teamid),placement:"top"},{default:S((()=>[T(m,{shape:"square",size:24,fit:"cover",src:e.getTeamAvatar(a.lineupData.teamid,60),onError:e=>!0},{default:S((()=>[g("img",{src:u},null,8,Ce)])),_:2},1032,["src"])])),_:2},1032,["content"]),T(m,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,Pe)])),_:2},1032,["src"])]),g("div",Te,[T(h,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",Se,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,$e)])])),error:S((()=>[g("div",_e,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Ve)])])),_:2},1032,["src"])])]),g("div",Ne,[T(b,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],10,he)))),128))])),[[$,e.loading]]),g("div",je,[T(D,{type:"primary",icon:e.ArrowRightBold,onClick:e.handleToRight},null,8,["icon","onClick"])]),g("div",Oe,[(y(!0),f(L,null,M(e.pendingTransferData,(a=>(y(),f("div",{class:"player-card flex-column-center",onContextmenu:A((t=>e.handleMenu(t,"menuVisible",a)),["prevent"]),title:a.label+"("+a.value+")",key:a.value},[g("div",Fe,[g("span",Le,j(a.playerdata.overallrating),1),g("div",Me,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",qe,[g("div",Be,[T(v,{effect:"dark",content:e.getTeamName(a.lineupData.teamid),placement:"top"},{default:S((()=>[T(m,{shape:"square",size:24,fit:"cover",src:e.getTeamAvatar(a.lineupData.teamid,60),onError:e=>!0},{default:S((()=>[g("img",{src:u},null,8,Ae)])),_:2},1032,["src"])])),_:2},1032,["content"]),T(m,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,ze)])),_:2},1032,["src"])]),g("div",Ie,[T(h,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",Je,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Ue)])])),error:S((()=>[g("div",Re,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,We)])])),_:2},1032,["src"])])]),g("div",He,[T(b,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],40,Ee)))),128))])])])])),_:1},8,["modelValue","title","before-close"]),e.menuVisible?(y(),N(C,{key:0,visible:e.menuVisible,left:e.left,top:e.top,isEdit:!1,onDelete:e.handleDelete,contextData:e.contextData},null,8,["visible","left","top","onDelete","contextData"])):w("",!0)],64)}],["__scopeId","data-v-136a0bf6"]]);const Qe=p({name:"SaveState",components:{},props:{state:{type:Object,default:function(){return{text:"saving",status:"loading"}}}},setup(e,a){let t=v({});return n(n({},D(t)),{})}}),Ge={class:"save-box flex-center"};var Ke=X(Qe,[["render",function(e,a,t,l,r,s){const i=P("Loading"),n=P("el-icon"),o=P("CircleCheck"),c=P("CircleClose");return y(),f("div",Ge,[g("p",null,j(e.$t(`message.${e.state.text}`)),1),"loading"===e.state.status?(y(),N(n,{key:0,class:"is-loading"},{default:S((()=>[T(i)])),_:1})):"success"===e.state.status?(y(),N(n,{key:1},{default:S((()=>[T(o)])),_:1})):"error"===e.state.status?(y(),N(n,{key:2},{default:S((()=>[T(c)])),_:1})):w("",!0)])}],["__scopeId","data-v-c02762ea"]]);const Ze=p({name:"TransferFreeDialog",components:{playerSelector:me},props:{visible:{type:Boolean,default:!1},row:{type:Object,default:null}},emits:["close","save"],setup(e,a){const{proxy:t}=C(),l=U(),r=H();let s=v({dialogVisible:e.visible,selectPlayerData:{jerseynumber:"",position:"29",teamid:"",playerid:""},playerdata:{}}),i={handleClose(){s.dialogVisible=!1,a.emit("close")},async handleConfirm(){if(""==s.selectPlayerData.playerid||""==s.selectPlayerData.jerseynumber)return;s.selectPlayerData.teamid=t.$route.query.teamid;let e=[{label:r.getPlayerName.value(s.playerdata.firstnameid,s.playerdata.lastnameid,s.playerdata.commonnameid),value:s.playerdata.playerid,playerdata:s.playerdata,lineupData:n({},s.selectPlayerData)}];a.emit("save",e)}};return z((()=>{""!=s.selectPlayerData.playerid&&(s.playerdata=l.data.players.find((e=>e.playerid==s.selectPlayerData.playerid)))})),h((()=>{})),n(n(n(n({},D(s)),i),H()),W())}}),ea={class:"flex-column-center"},aa={class:"flex-center"},ta={style:{"padding-right":"20px"}},la={class:"flex-center",style:{"margin-top":"20px"}},ra={style:{"padding-right":"8px"}},sa={key:0,class:"transfer-player-box"},ia={class:"player-team"},na={class:"image-slot"},oa=["src"],ca={class:"image-slot"},da=["src"],ua={class:"player-avatar"},pa={class:"image-slot"},ma=["src"],ya={class:"image-slot"},fa=["src"],ga={class:"dialog-footer"};const va=p({name:"TeamLineupEdit",components:{Marquees:re,playerMenu:ce,TransferDialog:Ye,SaveState:Ke,TransferFreeDialog:X(Ze,[["render",function(e,a,t,l,r,s){const i=P("playerSelector"),n=P("el-input"),o=P("el-image"),d=P("el-button"),p=P("el-dialog");return y(),N(p,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogVisible=a),title:e.$t("message.free"),"before-close":e.handleClose,"custom-class":"z-dialog",center:"",width:500},{footer:S((()=>[g("span",ga,[T(d,{onClick:e.handleClose},{default:S((()=>[F(j(e.$t("message.cancel")),1)])),_:1},8,["onClick"]),T(d,{type:"primary",onClick:e.handleConfirm},{default:S((()=>[F(j(e.$t("message.confirm")),1)])),_:1},8,["onClick"])])])),default:S((()=>[g("div",ea,[g("div",aa,[g("span",ta,j(e.$t("message.playerids")),1),T(i,{modelValue:e.selectPlayerData.playerid,"onUpdate:modelValue":a[0]||(a[0]=a=>e.selectPlayerData.playerid=a),style:{width:"200px"}},null,8,["modelValue"])]),g("div",la,[g("span",ra,j(e.$t("message.kitNumber")),1),T(n,{modelValue:e.selectPlayerData.jerseynumber,"onUpdate:modelValue":a[1]||(a[1]=a=>e.selectPlayerData.jerseynumber=a),style:{width:"200px"},placeholder:e.$t("message.editNumber")},null,8,["modelValue","placeholder"])]),e.playerdata.playerid?(y(),f("div",sa,[g("div",ia,[T(o,{style:{height:"100%",width:"100%"},lazy:"",src:e.getTeamAvatar(e.$route.query.teamid,120),fit:"cover"},{placeholder:S((()=>[g("div",na,[g("img",{src:u,style:{"object-fit":"cover"}},null,8,oa)])])),error:S((()=>[g("div",ca,[g("img",{src:u,style:{"object-fit":"cover"}},null,8,da)])])),_:1},8,["src"])]),g("div",ua,[T(o,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(e.playerdata.playerid,120),fit:"cover"},{placeholder:S((()=>[g("div",pa,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,ma)])])),error:S((()=>[g("div",ya,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,fa)])])),_:1},8,["src"])]),g("p",null,j(e.getPlayerName(e.playerdata.firstnameid,e.playerdata.lastnameid,e.playerdata.commonnameid)),1)])):w("",!0)])])),_:1},8,["modelValue","title","before-close"])}],["__scopeId","data-v-3e37d8bf"]])},props:{},setup(e,a){const t=U(),{proxy:l}=C(),r=W(),s=H();let i=v({lineupData:[],isNotFound:!1,isSwap:!1,transferPlayer:!1,addPlayer:!1,currentTeamFormation:{},selectOptions:[],cloneSelectOptions:[],startingLineups:[],teamFormationData:{},swapData:[],menuVisible:!1,left:0,top:0,contextData:null,savingState:{text:"saving",status:"loading"},autoSaveVisible:!1,timer:null,count:0,saveloading:!1}),c=I((()=>{let e=i.lineupData.filter((e=>parseInt(e.lineupData.position)<28));if(e.length<11){let a=11-e.length,t=0;for(let l=0;l<i.lineupData.length&&t!=a;l++)28==parseInt(i.lineupData[l].lineupData.position)&&(e.push(i.lineupData[l]),t++);return e}return e.length>11?e.slice(0,11):e})),d=I((()=>{let e=i.lineupData.filter((e=>28==parseInt(e.lineupData.position))),a=i.lineupData.filter((e=>parseInt(e.lineupData.position)<28)),t=e.filter((e=>!a.some((a=>a.value===e.value))));if(a.length>11){t=[...a.slice(11),...t]}if(t.length<7){let e=7-t.length,a=0;for(let l=0;l<i.lineupData.length&&a!=e;l++)29==parseInt(i.lineupData[l].lineupData.position)&&(t.push(i.lineupData[l]),a++);return t}return t.slice(0,7)})),u=I((()=>{let e=i.lineupData.filter((e=>28==parseInt(e.lineupData.position))),a=i.lineupData.filter((e=>29==parseInt(e.lineupData.position)));if(e.length>7){return[...e.slice(e.length-1),...a]}return a})),p={handleUpdateNumber(e){i.menuVisible=!1,J.prompt(l.$t("message.editNumber"),l.$t("message.edit"),{confirmButtonText:l.$t("message.confirm"),cancelButtonText:l.$t("message.cancel"),inputPattern:/^[0-9]*$/,inputValue:e.jerseynumber,inputErrorMessage:l.$t("message.inputError")}).then((({value:a})=>{i.lineupData.forEach((t=>{t.value==e.id&&(t.lineupData.jerseynumber=a)}))})).catch((e=>{}))},handleDelete(e){J.confirm(l.$t("message.isReleaseContract"),l.$t("message.warning"),{confirmButtonText:l.$t("message.confirm"),cancelButtonText:l.$t("message.cancel"),type:"warning"}).then((()=>{let a=i.lineupData.findIndex((a=>a.value==e));a>=0&&i.lineupData.splice(a,1),p.updateFormationModel()})).catch((()=>{})),i.menuVisible=!1},closeMenu(){i.menuVisible=!1},handleMenu(e,a,t=null){p.closeMenu(),setTimeout((()=>{i[a]=!0,i.left=e.pageX,i.top=e.pageY,i.contextData=t}),100)},getTeamPlayerLineup(){const e=l.$route.query.teamid;if(!t.data.teamplayerlinks)return void(i.isNotFound=!0);let a=t.data.teamplayerlinks.map((a=>{let l=null,r=null;a.teamid==e&&(l=t.data.players.find((e=>e.playerid==a.playerid)),r=a);let i=l?s.getPlayerName.value(l.firstnameid,l.lastnameid,l.commonnameid):"";return l?{label:i,value:a.playerid,playerdata:l,lineupData:r}:null}));i.lineupData=JSON.parse(JSON.stringify(a.filter(Boolean))),p.updateFormationModel()},handleSave(){i.lineupData.length&&(i.timer&&clearTimeout(i.timer),i.saveloading=!0,i.autoSaveVisible=!0,i.timer=setTimeout((()=>{let e=[];JSON.parse(JSON.stringify(Y(i.lineupData))).forEach((a=>{e.push(a.lineupData)}));let a=JSON.parse(JSON.stringify(i.currentTeamFormation));a.teamid=l.$route.query.teamid,a.formationid=i.teamFormationData.formationid;const r=t.saveLineupData("teamplayerlinks",e,l.$route.query.teamid,a);i.savingState=r?{text:"saveSucceeded",status:"success"}:{text:"saveFailed",status:"error"},i.saveloading=!1,setTimeout((()=>{i.autoSaveVisible=!1,i.savingState={text:"saving",status:"loading"}}),2e3)}),2e3))},handleChange(e){i.currentTeamFormation=JSON.parse(JSON.stringify(r.getTeamFormationById.value(e))),p.updateFormationModel()},updateFormationModel(){if("{}"===JSON.stringify(i.currentTeamFormation))return;let e=Y(c.value),a=r.getTeamRelativeFormation.value(i.currentTeamFormation.relativeformationid);e.forEach(((e,t)=>{e.lineupData.position=a[`position${t}`]})),i.startingLineups=e.map(((e,a)=>{let t=Number(e.lineupData.position);return n({offsetX:l.$config.formationPos[t].x,offsetY:l.$config.formationPos[t].y},e)}))},handleClick(e){for(let a=0;a<i.swapData.length;a++)if(i.swapData[a].value==e.value)return void i.swapData.splice(a,1);i.swapData.length>=2||i.swapData.push(e)},handleSwap(){if(!i.swapData.length)return;let e=i.swapData[0].lineupData.position;i.swapData[0].lineupData.position=i.swapData[1].lineupData.position,i.swapData[1].lineupData.position=e;let a=i.lineupData.findIndex((e=>e.value==i.swapData[0].value)),t=i.lineupData.findIndex((e=>e.value==i.swapData[1].value)),l=JSON.parse(JSON.stringify(i.lineupData));l[a]=l.splice(t,1,l[a])[0],i.lineupData=l,i.swapData.length=0,p.updateFormationModel()},handleTransfer(e){e.forEach((e=>{e.lineupData.position="29"})),i.transferPlayer=!1,i.addPlayer=!1;let a=new Set([...i.lineupData,...e]);i.lineupData=Array.from(a)}};return h((()=>{i.currentTeamFormation=r.getTeamFormation.value(l.$route.query.teamid,0),i.teamFormationData=r.getTeamFormation.value(l.$route.query.teamid,1),i.selectOptions=t.getAllFormationList(),i.cloneSelectOptions=JSON.parse(JSON.stringify(i.selectOptions)),p.getTeamPlayerLineup(),document.addEventListener("keydown",(e=>{let a=e||window.event||arguments.callee.caller.arguments[0];(a&&13==a.keyCode||"Enter"==a.key)&&p.handleSwap()})),document.addEventListener("click",p.closeMenu)})),b((()=>{document.removeEventListener("keydown",(e=>{let a=e||window.event||arguments.callee.caller.arguments[0];(a&&13==a.keyCode||"Enter"==a.key)&&p.handleSwap()})),document.removeEventListener("click",p.closeMenu),i.timer&&clearTimeout(i.timer)})),z((()=>{})),o(n(n(o(n(n({},D(i)),p),{editSpaceStore:t}),r),s),{getStarting11Players:c,getSubPlayers:d,getResPlayers:u})}}),ha={class:"full-layout flex-column-center scrollbar routerview",style:{"overflow-y":"auto"}},ba={class:"flex-between full-w edit-header"},Da={class:"flex-end",style:{"margin-left":"10px"}},xa={class:"player-box full-layout"},wa={class:"flex-between flex-warp"},ka={class:"flex-start",style:{"align-items":"flex-end"}},Ca={class:"team-avatar"},Pa={class:"image-slot"},Ta=["src"],Sa={class:"image-slot"},$a=["src"],_a={class:"flex-column-end player-info"},Va={class:"player-name text-left"},Na={class:"flex-start"},ja=["src"],Oa={class:"player-formation"},Ea={style:{"margin-left":"10px"}},Fa={class:"flex-end select-box"},La={key:0,class:"flex-start flex-warp",style:{"margin-top":"20px","justify-content":"flex-start","align-items":"flex-start"}},Ma={class:"field-large margin-1"},qa=["src"],Ba=["title","onClick"],Aa={class:"flex-start full-w"},za={class:"player-ability"},Ia={class:"player-position"},Ja={class:"flex-center"},Ua={class:"flex-column-center"},Ra=["src"],Wa={class:"player-number"},Ha={class:"player-avatar"},Xa={class:"image-slot"},Ya=["src"],Qa={class:"image-slot"},Ga=["src"],Ka={class:"player-name-1"},Za={style:{flex:"1"}},et={class:"tab-1"},at={class:"flex-start flex-warp lineup-box starting11-box full-w margin-1 scrollAuto scrollbar"},tt=["title","onClick","onContextmenu"],lt={class:"flex-start full-w"},rt={class:"player-ability"},st={class:"player-position"},it={class:"flex-center"},nt={class:"flex-column-center"},ot=["src"],ct={class:"player-number"},dt={class:"player-avatar"},ut={class:"image-slot"},pt=["src"],mt={class:"image-slot"},yt=["src"],ft={class:"player-name-1"},gt={class:"full-w"},vt={class:"tab-1"},ht={class:"flex-start flex-warp lineup-box sub-box full-w margin-1"},bt=["onClick","onContextmenu","title"],Dt={class:"flex-start full-w"},xt={class:"player-ability"},wt={class:"player-position"},kt={class:"flex-center"},Ct={class:"flex-column-center"},Pt=["src"],Tt={class:"player-number"},St={class:"player-avatar"},$t={class:"image-slot"},_t=["src"],Vt={class:"image-slot"},Nt=["src"],jt={class:"player-name-1"},Ot={class:"full-w"},Et={class:"tab-1"},Ft={class:"flex-start flex-warp lineup-box res-box full-w margin-1"},Lt=["onClick","title","onContextmenu"],Mt={class:"flex-start full-w"},qt={class:"player-ability"},Bt={class:"player-position"},At={class:"flex-center"},zt={class:"flex-column-center"},It=["src"],Jt={class:"player-number"},Ut={class:"player-avatar"},Rt={class:"image-slot"},Wt=["src"],Ht={class:"image-slot"},Xt=["src"],Yt={class:"player-name-1"};var Qt=X(va,[["render",function(e,a,t,l,r,s){const i=P("ArrowLeftBold"),n=P("el-icon"),o=P("el-button"),p=P("el-skeleton"),m=P("el-empty"),v=P("el-image"),h=P("el-avatar"),b=P("el-select-v2"),D=P("Marquees"),x=P("playerMenu"),C=P("TransferDialog"),_=P("TransferFreeDialog"),V=P("SaveState");return y(),f("div",ha,[e.editSpaceStore.isUpload?(y(),f(L,{key:0},[g("div",ba,[T(n,{class:"back-icon",onClick:a[0]||(a[0]=a=>e.$router.go(-1))},{default:S((()=>[T(i)])),_:1}),g("div",Da,[2===e.swapData.length?(y(),N(o,{key:0,type:"primary",onClick:e.handleSwap},{default:S((()=>[F(j(e.$t("message.swap")),1)])),_:1},8,["onClick"])):w("",!0),T(o,{type:"warning",onClick:a[1]||(a[1]=a=>e.transferPlayer=!0)},{default:S((()=>[F(j(e.$t("message.transfer")),1)])),_:1}),T(o,{type:"danger",onClick:a[2]||(a[2]=a=>e.addPlayer=!0)},{default:S((()=>[F(j(e.$t("message.addPlayer")),1)])),_:1}),T(o,{type:"success",onClick:e.handleSave,loading:e.saveloading},{default:S((()=>[F(j(e.$t("message.save")),1)])),_:1},8,["onClick","loading"])])]),g("div",xa,[e.lineupData.length||e.isNotFound?!e.lineupData.length&&e.isNotFound?(y(),N(m,{key:1,description:e.$t("message.notfound")},null,8,["description"])):(y(),f(L,{key:2},[g("div",wa,[g("div",ka,[g("div",Ca,[T(v,{style:{height:"100%",width:"100%"},lazy:"",src:e.getTeamAvatar(e.$route.query.teamid,120),fit:"cover"},{placeholder:S((()=>[g("div",Pa,[g("img",{src:u,style:{"object-fit":"cover"}},null,8,Ta)])])),error:S((()=>[g("div",Sa,[g("img",{src:u,style:{"object-fit":"cover"}},null,8,$a)])])),_:1},8,["src"])]),g("div",_a,[g("p",Va,j(e.getTeamName(e.$route.query.teamid)),1),g("div",Na,[T(h,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getTeamNationFlag(e.$route.query.teamid),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,ja)])),_:1},8,["src"]),g("span",Oa,j(e.getTeamLeagueName(e.$route.query.teamid)),1),g("span",Ea,"(球员人数) "+j(e.lineupData.length)+"人",1)])])]),g("div",Fa,[T(b,{modelValue:e.currentTeamFormation.formationid,"onUpdate:modelValue":a[3]||(a[3]=a=>e.currentTeamFormation.formationid=a),filterable:"",options:e.selectOptions,onVisibleChange:a[4]||(a[4]=a=>e.selectOptions=e.cloneSelectOptions),onChange:e.handleChange,"value-key":"value.formationid",placeholder:e.$t("message.selectPlaceholder")},null,8,["modelValue","options","onChange","placeholder"])])]),e.lineupData&&e.lineupData.length>0?(y(),f("div",La,[g("div",Ma,[g("img",{src:"/static/png/field-4e1fdc65.png"},null,8,qa),(y(!0),f(L,null,M(e.startingLineups,(a=>(y(),f("div",{class:k(["player-card player-card-1 flex-column-center",{"player-card-active":e.swapData.length&&e.swapData.find((e=>e.value==a.value))}]),style:$({left:a.offsetX+"%",bottom:a.offsetY+"%"}),title:a.label+"("+a.value+")",onClick:t=>e.handleClick(a),key:a.value},[g("div",Aa,[g("span",za,j(a.playerdata.overallrating),1),g("div",Ia,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",Ja,[g("div",Ua,[T(h,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,Ra)])),_:2},1032,["src"]),g("p",Wa,j(a.lineupData.jerseynumber),1)]),g("div",Ha,[T(v,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",Xa,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Ya)])])),error:S((()=>[g("div",Qa,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Ga)])])),_:2},1032,["src"])])]),g("div",Ka,[T(D,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],14,Ba)))),128))]),g("div",Za,[g("div",et,j(e.$t("message.starting")),1),g("div",at,[(y(!0),f(L,null,M(e.getStarting11Players,(a=>(y(),f("div",{class:k(["player-card flex-column-center",{"player-card-active":e.swapData.length&&e.swapData.find((e=>e.value==a.value))}]),title:a.label+"("+a.value+")",onClick:t=>e.handleClick(a),onContextmenu:A((t=>e.handleMenu(t,"menuVisible",a)),["prevent"]),key:a.value},[g("div",lt,[g("span",rt,j(a.playerdata.overallrating),1),g("div",st,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",it,[g("div",nt,[T(h,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,ot)])),_:2},1032,["src"]),g("p",ct,j(a.lineupData.jerseynumber),1)]),g("div",dt,[T(v,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",ut,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,pt)])])),error:S((()=>[g("div",mt,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,yt)])])),_:2},1032,["src"])])]),g("div",ft,[T(D,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],42,tt)))),128))])]),g("div",gt,[g("div",vt,j(e.$t("message.sub")),1),g("div",ht,[(y(!0),f(L,null,M(e.getSubPlayers,(a=>(y(),f("div",{class:k(["player-card flex-column-center",{"player-card-active":e.swapData.length&&e.swapData.find((e=>e.value==a.value))}]),onClick:t=>e.handleClick(a),onContextmenu:A((t=>e.handleMenu(t,"menuVisible",a)),["prevent"]),title:a.label+"("+a.value+")",key:a.value},[g("div",Dt,[g("span",xt,j(a.playerdata.overallrating),1),g("div",wt,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",kt,[g("div",Ct,[T(h,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,Pt)])),_:2},1032,["src"]),g("p",Tt,j(a.lineupData.jerseynumber),1)]),g("div",St,[T(v,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",$t,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,_t)])])),error:S((()=>[g("div",Vt,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Nt)])])),_:2},1032,["src"])])]),g("div",jt,[T(D,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],42,bt)))),128))])]),g("div",Ot,[g("div",Et,j(e.$t("message.res")),1),g("div",Ft,[(y(!0),f(L,null,M(e.getResPlayers,(a=>(y(),f("div",{class:k(["player-card flex-column-center",{"player-card-active":e.swapData.length&&e.swapData.find((e=>e.value==a.value))}]),onClick:t=>e.handleClick(a),title:a.label+"("+a.value+")",onContextmenu:A((t=>e.handleMenu(t,"menuVisible",a)),["prevent"]),key:a.value},[g("div",Mt,[g("span",qt,j(a.playerdata.overallrating),1),g("div",Bt,j(e.getPlayerPositionByCode(a.playerdata.preferredposition1)),1)]),g("div",At,[g("div",zt,[T(h,{shape:"square",size:24,style:{width:"24px",height:"16px"},fit:"cover",src:e.getPlayerNationFlag(a.playerdata.nationality),onError:e=>!0},{default:S((()=>[g("img",{src:d},null,8,It)])),_:2},1032,["src"]),g("p",Jt,j(a.lineupData.jerseynumber),1)]),g("div",Ut,[T(v,{style:{height:"100%",width:"100%"},lazy:"",src:e.getPlayerAvatar(a.playerdata.playerid,60),fit:"cover"},{placeholder:S((()=>[g("div",Rt,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Wt)])])),error:S((()=>[g("div",Ht,[g("img",{src:c,style:{"object-fit":"cover"}},null,8,Xt)])])),_:2},1032,["src"])])]),g("div",Yt,[T(D,null,{default:S((()=>[F(j(a.label),1)])),_:2},1024)])],42,Lt)))),128))])])])):w("",!0)],64)):(y(),N(p,{key:0,rows:20,animated:""}))])],64)):(y(),N(m,{key:1,description:e.$t("message.errorInfo")},null,8,["description"])),e.menuVisible?(y(),N(x,{key:2,visible:e.menuVisible,left:e.left,top:e.top,onUpdateNumber:e.handleUpdateNumber,onDelete:e.handleDelete,contextData:e.contextData},null,8,["visible","left","top","onUpdateNumber","onDelete","contextData"])):w("",!0),e.transferPlayer?(y(),N(C,{key:3,visible:e.transferPlayer,onSave:e.handleTransfer,onClose:a[5]||(a[5]=a=>e.transferPlayer=!1)},null,8,["visible","onSave"])):w("",!0),e.addPlayer?(y(),N(_,{key:4,visible:e.addPlayer,onSave:e.handleTransfer,onClose:a[6]||(a[6]=a=>e.addPlayer=!1)},null,8,["visible","onSave"])):w("",!0),e.autoSaveVisible?(y(),N(V,{key:5,state:e.savingState},null,8,["state"])):w("",!0)])}],["__scopeId","data-v-7640201f"]]);export{Qt as default};
